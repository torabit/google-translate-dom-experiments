<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Google Dom Experiments</title>
    <script type="importmap">
      {
        "imports": {
          "react": "https://esm.sh/react@19.0.0",
          "react/": "https://esm.sh/react@19.0.0/",
          "react-dom/": "https://esm.sh/react-dom@19.0.0/"
        }
      }
    </script>
    <script type="module">
      // jsx/jsxs rule of thumb:
      //
      // - Use jsxs if the `children` prop is an array expression with no spreads
      // - Use jsx otherwise
      //
      // Also, when passing props,
      //
      // - Put the `key` named prop, if any, in the third argument
      // - Put all the other props in properties of the second argument
      //
      // Example:
      //
      // - <Component /> -> jsx(Component, {})
      // - <Component>{x}</Component> -> jsx(Component, { children: x })
      // - <Component>{x}{y}</Component> -> jsxs(Component, { children: [x, y] })
      // - <Component foo={bar} /> -> jsx(Component, { foo: bar })
      // - <Component key={k} /> -> jsx(Component, {}, k)

      import { jsx, jsxs, Fragment } from "react/jsx-runtime";
      import React, { useEffect, useRef, useState } from "react";
      import ReactDOMClient from "react-dom/client";

      function main() {
        const rootElement = document.getElementById("root");
        const root = ReactDOMClient.createRoot(rootElement);
        console.log(rootElement);
        root.render(
          //<>
          jsxs(Fragment, {
            children: [
              // <App/>
              jsx(App, {}),
            ],
          })
          // </>
        );
      }

      function App() {
        const containerRef = useRef(null);
        const [text, setText] = useState("Download");
        const [logs, setLogs] = useState([]);
        const [renderingRound, setRenderingRound] = useState(0);
        const textNodeMap = useRef(new Map());

        useEffect(() => {
          if (!containerRef.current) return;

          const children = Array.from(containerRef.current.children);
          children.forEach((child) => {
            const textNode = child.firstChild;

            if (textNode) {
              const currentRenderingRound = textNodeMap.current.get(textNode);
              textNodeMap.current.set(textNode, currentRenderingRound + 1);

              setLogs((prevLogs) => [
                ...prevLogs,
                `TextNode: "${textNode.textContent}" rendered ${
                  currentRenderingRound + 1
                } times`,
              ]);
            }
          });
          setRenderingRound((prev) => prev + 1);
        }, [text]);
        return (
          // <div>
          jsxs("div", {
            children: [
              // <h2>
              jsx("h2", {
                children: "Repact Text Node Tracking",
              }),
              // </h2>
              // <div>
              jsxs("div", {
                ref: containerRef,
                // <div>
                children: [
                  // {text}
                  text,
                  // <span>
                  jsx("span", { children: " Now!" }),
                  // </span>
                ],
                // </div>
              }),
              // </div>
              // <button>
              jsx("button", {
                children: "Change Text",
                onClick: () =>
                  setText((prev) =>
                    prev === "Download" ? "Get Started" : "Download"
                  ),
              }),
              // </button>
              // <h3>
              jsx("h3", {
                children: "Logs",
              }),
              // </h3>
              // <ul>
              jsx("ul", {
                children: logs.map(
                  (log) =>
                    // <li>
                    jsx("li", { children: log, key: log })
                  // </li>
                ),
              }),
              // </ul>
            ],
          })
          // </div>
        );
      }

      main();
    </script>
    <style></style>
  </head>
  <body>
    <div id="root"></div>
  </body>
</html>
